---
import "../styles/global.css";
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Contacto from "../components/Contacto.astro";
import { Image } from "astro:assets";

// Importar imágenes de cabañas
import cabana1 from "../assets/galeria/cabaña/IMG_2079.webp";
import cabana2 from "../assets/galeria/cabaña/IMG_2082.webp";
import cabana3 from "../assets/galeria/cabaña/IMG_2087.webp";
import cabana4 from "../assets/galeria/cabaña/IMG_2088.webp";

// Importar imágenes de comodidades
import comodidad1 from "../assets/galeria/comodidades/IMG_2045_resultado.webp";
import comodidad2 from "../assets/galeria/comodidades/IMG_2046_resultado.webp";
import comodidad3 from "../assets/galeria/comodidades/IMG_2057_resultado.webp";
import comodidad4 from "../assets/galeria/comodidades/IMG_2061_resultado.webp";
import comodidad5 from "../assets/galeria/comodidades/IMG_2062_resultado.webp";
import comodidad6 from "../assets/galeria/comodidades/IMG_2063_resultado.webp";
import comodidad7 from "../assets/galeria/comodidades/IMG_2064_resultado.webp";
import comodidad8 from "../assets/galeria/comodidades/IMG_2066_resultado.webp";
import comodidad9 from "../assets/galeria/comodidades/IMG_2074_resultado.webp";
import comodidad10 from "../assets/galeria/comodidades/IMG_2076_resultado.webp";

// Galería unificada con todas las imágenes optimizadas
const galleryImages = [
  {
    src: cabana1,
    alt: "Cabaña - Vista exterior",
    category: "Cabañas",
  },
  {
    src: cabana2,
    alt: "Cabaña - Detalle arquitectónico",
    category: "Cabañas",
  },
  {
    src: cabana3,
    alt: "Cabaña - Área común",
    category: "Cabañas",
  },
  {
    src: cabana4,
    alt: "Cabaña - Interior",
    category: "Cabañas",
  },
  {
    src: comodidad1,
    alt: "Instalaciones y servicios",
    category: "Comodidades",
  },
  {
    src: comodidad2,
    alt: "Áreas de recreación",
    category: "Comodidades",
  },
  {
    src: comodidad3,
    alt: "Espacios exteriores",
    category: "Comodidades",
  },
  {
    src: comodidad4,
    alt: "Zona de descanso",
    category: "Comodidades",
  },
  {
    src: comodidad5,
    alt: "Amenidades del complejo",
    category: "Comodidades",
  },
  {
    src: comodidad6,
    alt: "Servicios disponibles",
    category: "Comodidades",
  },
  {
    src: comodidad7,
    alt: "Áreas comunes",
    category: "Comodidades",
  },
  {
    src: comodidad8,
    alt: "Instalaciones recreativas",
    category: "Comodidades",
  },
  {
    src: comodidad9,
    alt: "Espacios de convivencia",
    category: "Comodidades",
  },
  {
    src: comodidad10,
    alt: "Entorno y naturaleza",
    category: "Comodidades",
  },
];
---

<Layout>
  <Header />

  <!-- Contenido principal -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Galería Unificada -->
    <section
      id="galeria"
      class="mb-20 pt-20 md:pt-24"
      style="scroll-margin-top: 5rem;"
    >
      <h2
        class="text-3xl md:text-4xl font-bold text-center text-accent-700 mb-4"
      >
        Galería de Fotos
      </h2>
      <p class="text-center text-accent-800 max-w-2xl mx-auto mb-8">
        Descubre nuestras cabañas y comodidades
      </p>

      <!-- Contenedor con ancho máximo -->
      <div class="max-w-4xl mx-auto">
        <!-- Slider Principal -->
        <div class="mb-6">
          <div id="gallery-container" class="swiper gallery-main relative rounded-lg overflow-hidden" style="aspect-ratio: 3/2;">
            <!-- Botón de pantalla completa -->
            <button
              id="fullscreen-btn"
              class="absolute top-4 right-4 z-20 bg-black/60 hover:bg-black/80 backdrop-blur-sm text-white p-2 rounded-lg transition-all"
              aria-label="Pantalla completa"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
              </svg>
            </button>
            
            <div class="swiper-wrapper">
            {
              galleryImages.map((image) => (
                <div class="swiper-slide">
                  <Image
                    src={image.src}
                    alt={image.alt}
                    class="w-full h-full object-cover"
                    widths={[600, 900, 1200]}
                    sizes="(max-width: 768px) 100vw, 1200px"
                  />
                  <div class="absolute bottom-4 left-4 bg-black/60 backdrop-blur-sm px-4 py-2 rounded-full">
                    <span class="text-white text-sm font-medium">
                      {image.category}
                    </span>
                  </div>
                </div>
              ))
            }
          </div>
          <div class="swiper-button-next !hidden md:!flex"></div>
          <div class="swiper-button-prev !hidden md:!flex"></div>
          <div class="swiper-pagination"></div>
        </div>
      </div>

      <!-- Thumbnails -->
      <div class="swiper gallery-thumbs">
        <div class="swiper-wrapper">
          {
            galleryImages.map((image) => (
              <div class="swiper-slide cursor-pointer" style="aspect-ratio: 3/2;">
                <Image
                  src={image.src}
                  alt={image.alt}
                  class="w-full h-full object-cover rounded-lg"
                  widths={[150, 200]}
                  sizes="150px"
                />
              </div>
            ))
          }
        </div>
      </div>
      </div>
    </section>

    <!-- Sección de Contacto -->
    <Contacto />
  </main>

  <!-- Footer -->
  <footer class="text-white py-8" style="background-color: #4d3124;">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p>&copy; 2025 Apapacho Colón. Todos los derechos reservados.</p>
    </div>
  </footer>
</Layout>

<style>
  /* Importar estilos de Swiper */
  @import "swiper/css";
  @import "swiper/css/navigation";
  @import "swiper/css/pagination";
  @import "swiper/css/thumbs";

  /* Personalizar botones de navegación */
  :global(.swiper-button-next),
  :global(.swiper-button-prev) {
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(4px);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    transition: all 0.2s ease;
    color: transparent !important;
  }

  :global(.swiper-button-next:after),
  :global(.swiper-button-prev:after) {
    display: none;
  }

  :global(.swiper-button-next),
  :global(.swiper-button-prev) {
    background-size: 16px 16px;
    background-repeat: no-repeat;
    background-position: center;
  }

  :global(.swiper-button-next) {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5l7 7-7 7'/%3E%3C/svg%3E");
  }

  :global(.swiper-button-prev) {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M15 19l-7-7 7-7'/%3E%3C/svg%3E");
  }

  :global(.swiper-button-next:hover),
  :global(.swiper-button-prev:hover) {
    background-color: rgba(0, 0, 0, 0.5);
    transform: scale(1.05);
  }

  /* Personalizar paginación */
  :global(.swiper-pagination-bullet) {
    background: #fff;
    opacity: 0.7;
    width: 10px;
    height: 10px;
  }

  :global(.swiper-pagination-bullet-active) {
    background: #fff;
    opacity: 1;
    width: 24px;
    border-radius: 5px;
  }

  /* Thumbnails por defecto - solo aplica a las miniaturas */
  :global(.gallery-thumbs .swiper-slide img) {
    opacity: 0.6;
    transition: opacity 0.3s ease;
  }

  :global(.gallery-thumbs .swiper-slide:hover img) {
    opacity: 1;
  }

  /* Estilo para thumbnails activos - sin filtro */
  :global(.swiper-slide-thumb-active) {
    opacity: 1 !important;
  }

  :global(.swiper-slide-thumb-active img) {
    opacity: 1 !important;
    border: 3px solid #d97706;
    border-radius: 0.5rem;
  }

  /* Asegurar que las imágenes principales siempre tengan opacidad completa */
  :global(.gallery-main .swiper-slide img) {
    opacity: 1 !important;
  }

  /* Prevenir selección de imágenes y texto en el slider */
  :global(.gallery-main) {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }

  :global(.gallery-main .swiper-slide img) {
    pointer-events: none;
    -webkit-user-drag: none;
    user-drag: none;
  }

  /* Estilos para pantalla completa */
  :global(#gallery-container:fullscreen) {
    background: #000;
    padding: 1rem;
    aspect-ratio: auto !important;
    height: 100vh;
  }

  :global(#gallery-container:fullscreen .swiper) {
    height: 100%;
    width: 100%;
  }

  :global(#gallery-container:fullscreen .swiper-wrapper) {
    align-items: center;
  }

  :global(#gallery-container:fullscreen .swiper-slide) {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 80vw !important;
    opacity: 0.4;
    transition: opacity 0.3s ease;
  }

  :global(#gallery-container:fullscreen .swiper-slide-active) {
    opacity: 1;
  }

  :global(#gallery-container:fullscreen .swiper-slide-prev),
  :global(#gallery-container:fullscreen .swiper-slide-next) {
    opacity: 0.6;
  }

  :global(#gallery-container:fullscreen .swiper-slide img) {
    object-fit: contain !important;
    max-height: 85vh;
    max-width: 75vw;
    width: auto !important;
    height: auto !important;
  }

  /* Ajuste para desktop en pantalla completa */
  @media (min-width: 768px) {
    :global(#gallery-container:fullscreen) {
      padding: 2rem;
    }

    :global(#gallery-container:fullscreen .swiper-slide img) {
      max-width: 80vw;
    }
  }

  /* Ocultar thumbnails y categorías en pantalla completa */
  :global(#gallery-container:fullscreen) ~ .gallery-thumbs {
    display: none;
  }

  :global(#gallery-container:fullscreen .swiper-slide > div:last-child) {
    display: none;
  }

  /* Cambiar icono del botón en pantalla completa */
  #fullscreen-btn.fullscreen-active svg {
    transform: rotate(45deg);
  }
</style>

<script>
  import Swiper from "swiper";
  import { Navigation, Pagination, Thumbs } from "swiper/modules";

  // Configuración para la galería unificada
  const galleryThumbs = new Swiper(".gallery-thumbs", {
    spaceBetween: 10,
    slidesPerView: 4,
    freeMode: true,
    watchSlidesProgress: true,
    breakpoints: {
      640: {
        slidesPerView: 6,
      },
      768: {
        slidesPerView: 8,
      },
      1024: {
        slidesPerView: 10,
      },
    },
  });

  const mainSwiper = new Swiper(".gallery-main", {
    modules: [Navigation, Pagination, Thumbs],
    spaceBetween: 10,
    slidesPerView: 1,
    centeredSlides: true,
    navigation: {
      nextEl: ".gallery-main .swiper-button-next",
      prevEl: ".gallery-main .swiper-button-prev",
    },
    pagination: {
      el: ".gallery-main .swiper-pagination",
      clickable: true,
      dynamicBullets: true,
    },
    thumbs: {
      swiper: galleryThumbs,
    },
    keyboard: {
      enabled: true,
    },
    loop: false,
  });

  // Funcionalidad de pantalla completa
  const fullscreenBtn = document.getElementById("fullscreen-btn");
  const galleryContainer = document.getElementById("gallery-container");

  if (fullscreenBtn && galleryContainer) {
    fullscreenBtn.addEventListener("click", () => {
      if (!document.fullscreenElement) {
        galleryContainer.requestFullscreen().catch((err) => {
          console.error("Error al entrar en pantalla completa:", err);
        });
      } else {
        document.exitFullscreen();
      }
    });

    // Actualizar el icono y configuración del swiper cuando cambia el estado
    document.addEventListener("fullscreenchange", () => {
      if (document.fullscreenElement) {
        fullscreenBtn.classList.add("fullscreen-active");
        // Configurar swiper para pantalla completa
        mainSwiper.params.slidesPerView = "auto";
        mainSwiper.params.spaceBetween = 30;
        mainSwiper.params.centeredSlides = true;
        mainSwiper.update();
      } else {
        fullscreenBtn.classList.remove("fullscreen-active");
        // Restaurar configuración normal
        mainSwiper.params.slidesPerView = 1;
        mainSwiper.params.spaceBetween = 10;
        mainSwiper.params.centeredSlides = true;
        mainSwiper.update();
      }
    });

    // Permitir salir de pantalla completa con ESC
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && document.fullscreenElement) {
        document.exitFullscreen();
      }
    });
  }
</script>